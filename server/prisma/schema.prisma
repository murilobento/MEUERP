// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ==================== MÓDULO ADMINISTRATIVO ====================

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String
  avatar    String?
  status    UserStatus @default(ACTIVE)
  role      UserRole   @default(VIEWER)
  
  departments Department[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  lastLogin DateTime?
  
  // Relações
  salesCreated    Sale[]     @relation("SalesCreatedBy")
  purchasesCreated Purchase[] @relation("PurchasesCreatedBy")
  assignedCards   Card[]
  
  ownedBoards     Board[]    @relation("BoardOwner")
  memberBoards    Board[]    @relation("BoardMembers")
  invitations     BoardInvitation[]
  
  @@map("users")
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

enum UserRole {
  ADMIN
  MANAGER
  EDITOR
  VIEWER
}

model Department {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  
  users User[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("departments")
}

// ==================== MÓDULO FINANCEIRO ====================

model Account {
  id          Int      @id @default(autoincrement())
  name        String
  type        AccountType
  balance     Decimal  @default(0) @db.Decimal(15, 2)
  description String?
  
  transactions Transaction[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("accounts")
}

enum AccountType {
  CHECKING
  SAVINGS
  CASH
  CREDIT_CARD
}

model Transaction {
  id          Int      @id @default(autoincrement())
  description String
  amount      Decimal  @db.Decimal(15, 2)
  type        TransactionType
  date        DateTime @default(now())
  
  accountId   Int
  account     Account @relation(fields: [accountId], references: [id])

  categoryId  Int
  category    TransactionCategory @relation(fields: [categoryId], references: [id])
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("transactions")
}

model TransactionCategory {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  type        TransactionType
  
  transactions Transaction[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("transaction_categories")
}

enum TransactionType {
  INCOME
  EXPENSE
}

// ==================== MÓDULO ESTOQUE ====================

model Product {
  id          Int      @id @default(autoincrement())
  code        String?  @unique
  name        String
  description String?
  price       Decimal  @db.Decimal(10, 2)
  cost        Decimal  @db.Decimal(10, 2)
  stock       Int      @default(0)
  minStock    Int      @default(0)
  unit        String   @default("UN")
  
  barcode     String?
  status      ProductStatus @default(ACTIVE)
  imageUrl    String?
  
  width       Decimal? @db.Decimal(10, 2)
  height      Decimal? @db.Decimal(10, 2)
  length      Decimal? @db.Decimal(10, 2)
  weight      Decimal? @db.Decimal(10, 2)

  categoryId  Int?
  category    Category? @relation(fields: [categoryId], references: [id])
  
  supplierId  Int?
  supplier    Supplier? @relation(fields: [supplierId], references: [id])
  
  saleItems     SaleItem[]
  purchaseItems PurchaseItem[]
  stockMovements StockMovement[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("products")
}

enum ProductStatus {
  ACTIVE
  INACTIVE
}

model Category {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  
  products Product[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("categories")
}

model StockMovement {
  id          Int      @id @default(autoincrement())
  type        MovementType
  quantity    Int
  reason      String?
  date        DateTime @default(now())
  
  productId   Int
  product     Product @relation(fields: [productId], references: [id])
  
  createdAt DateTime @default(now())
  
  @@map("stock_movements")
}

enum MovementType {
  IN
  OUT
  ADJUSTMENT
}

// ==================== MÓDULO COMERCIAL ====================

model Customer {
  id          Int      @id @default(autoincrement())
  name        String
  email       String?  @unique
  phone       String?
  document    String?  @unique // CPF/CNPJ
  type        CustomerType @default(INDIVIDUAL)
  status      CustomerStatus @default(ACTIVE)
  
  // Endereço
  zipCode     String?
  street      String?
  number      String?
  complement  String?
  neighborhood String?
  city        String?
  state       String?
  
  sales Sale[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("customers")
}

enum CustomerType {
  INDIVIDUAL
  COMPANY
}

enum CustomerStatus {
  ACTIVE
  INACTIVE
}

model Supplier {
  id          Int      @id @default(autoincrement())
  name        String
  email       String?  @unique
  phone       String?
  document    String?  @unique // CPF/CNPJ
  type        SupplierType @default(COMPANY)
  status      SupplierStatus @default(ACTIVE)
  
  // Endereço
  zipCode     String?
  street      String?
  number      String?
  complement  String?
  neighborhood String?
  city        String?
  state       String?
  
  purchases Purchase[]
  products  Product[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("suppliers")
}

enum SupplierType {
  INDIVIDUAL
  COMPANY
}

enum SupplierStatus {
  ACTIVE
  INACTIVE
}

model Sale {
  id          Int      @id @default(autoincrement())
  number      String   @unique
  date        DateTime @default(now())
  status      SaleStatus @default(PENDING)
  
  subtotal    Decimal  @db.Decimal(15, 2)
  discount    Decimal  @default(0) @db.Decimal(15, 2)
  total       Decimal  @db.Decimal(15, 2)
  paymentMethod PaymentMethod?
  
  notes       String?  @db.Text
  
  customerId  Int
  customer    Customer @relation(fields: [customerId], references: [id])
  
  createdById Int
  createdBy   User @relation("SalesCreatedBy", fields: [createdById], references: [id])
  
  items SaleItem[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("sales")
}

enum SaleStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

enum PaymentMethod {
  DEBIT_CARD
  CREDIT_CARD
  CASH
  PIX
  BOLETO
}

model SaleItem {
  id          Int      @id @default(autoincrement())
  quantity    Int
  price       Decimal  @db.Decimal(10, 2)
  subtotal    Decimal  @db.Decimal(15, 2)
  
  saleId      Int
  sale        Sale @relation(fields: [saleId], references: [id], onDelete: Cascade)
  
  productId   Int
  product     Product @relation(fields: [productId], references: [id])
  
  @@map("sale_items")
}

model Purchase {
  id          Int      @id @default(autoincrement())
  number      String   @unique
  date        DateTime @default(now())
  status      PurchaseStatus @default(PENDING)
  
  subtotal    Decimal  @db.Decimal(15, 2)
  discount    Decimal  @default(0) @db.Decimal(15, 2)
  total       Decimal  @db.Decimal(15, 2)
  
  notes       String?  @db.Text
  
  supplierId  Int
  supplier    Supplier @relation(fields: [supplierId], references: [id])
  
  createdById Int
  createdBy   User @relation("PurchasesCreatedBy", fields: [createdById], references: [id])
  
  items PurchaseItem[]
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("purchases")
}

enum PurchaseStatus {
  PENDING
  RECEIVED
  CANCELLED
}

model PurchaseItem {
  id          Int      @id @default(autoincrement())
  quantity    Int
  price       Decimal  @db.Decimal(10, 2)
  subtotal    Decimal  @db.Decimal(15, 2)
  
  purchaseId  Int
  purchase    Purchase @relation(fields: [purchaseId], references: [id], onDelete: Cascade)
  
  productId   Int
  product     Product @relation(fields: [productId], references: [id])
  
  @@map("purchase_items")
}

// ==================== CONFIGURAÇÕES ====================

model Company {
  id          Int      @id @default(autoincrement())
  name        String
  cnpj        String?
  email       String?
  phone       String?
  website     String?
  
  // Endereço
  street      String?
  number      String?
  complement  String?
  neighborhood String?
  city        String?
  state       String?
  zipCode     String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("company_settings")
}

// ==================== MÓDULO KANBAN ====================

model Board {
  id          Int      @id @default(autoincrement())
  title       String
  description String?
  color       String   @default("#6366f1") // Cor do board
  
  ownerId     Int
  owner       User     @relation("BoardOwner", fields: [ownerId], references: [id])
  
  members     User[]   @relation("BoardMembers")
  
  columns     Column[]
  invitations BoardInvitation[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("boards")
}

model Column {
  id          Int      @id @default(autoincrement())
  title       String
  position    Int      // Ordem da coluna no board
  color       String   @default("#64748b")
  
  boardId     Int
  board       Board    @relation(fields: [boardId], references: [id], onDelete: Cascade)
  
  cards       Card[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("columns")
}

model Card {
  id          Int      @id @default(autoincrement())
  title       String
  description String?  @db.Text
  position    Int      // Ordem do card na coluna
  priority    CardPriority @default(MEDIUM)
  dueDate     DateTime?
  
  columnId    Int
  column      Column   @relation(fields: [columnId], references: [id], onDelete: Cascade)
  
  assignedToId Int?
  assignedTo   User?   @relation(fields: [assignedToId], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("cards")
}

enum CardPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

model BoardInvitation {
  id          Int      @id @default(autoincrement())
  status      InvitationStatus @default(PENDING)
  
  boardId     Int
  board       Board    @relation(fields: [boardId], references: [id], onDelete: Cascade)
  
  inviteeId   Int
  invitee     User     @relation(fields: [inviteeId], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([boardId, inviteeId])
  @@map("board_invitations")
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  REJECTED
}
